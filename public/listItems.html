<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>My document</title>
    <link rel="stylesheet" href="./css/style.css">
</head>

<body>

    <header>
        <h1 id="listNameHeader"></h1>
        
        <div class="updateDelete">
        <input type="text" id="listName">
        <button id="updateList">Update list</button>
        <button id="deleteList">Delete list</button>
    </div>
        <button id="togglePublic">Toggle Public</button>
        <p id="publicStatus">List is private</p>

        <div class="dropdown">
            <button id="user" class="dropbtn"></button>
            <div class="dropdown-content">
                <button onclick="logout()">Logout</button>
                <button onclick="updateuUser()">Update user</button>
            </div>
        </div>

    </header>
    <hr>
    <input type="text" id="inputItem">
    <button id="newItem">New Item</button>

    <input type="text" id="inputItem">
    <button id="updateItem">Update Item</button>
    <button id="updateItem">Delete Item</button>
    <p id="activeItem">Selected item:</p>
    

    <div id="container"></div>

    

</body>


<script>
    //DOM
    const user = document.getElementById("user");
    const listName = document.getElementById("listName");
    const listNameHeader = document.getElementById("listNameHeader");
    const inputItem = document.getElementById("inputItem");


    let logindataJson = localStorage.getItem("logindata");
    if (logindataJson === null) {
        logindataJson = '{"token":"null"}';
    }
    let logindata = JSON.parse(logindataJson);
    let logindataString = JSON.stringify(logindata.token);

    //Viser hvem som er logget inn
    let greetings = ["Hello ", "Howdy ", "Hey ", "Greetings ", "Welcome ", "Hiya ", "Ahoy ", "Bonjour ", "Hola ", "Aloha ", "Hai ", "Hei ", "Sup ", "How you doing ", "Ay yo ", "Wassap ", "I see you ", "I'm watching you "];
    let randomGreet = Math.floor(Math.random() * greetings.length);
    user.innerText = greetings[randomGreet] + logindata.username;

    const listDataJson = localStorage.getItem("listData");
    const listData = JSON.parse(listDataJson);
    const listGroupsId = JSON.stringify(listData.listGroupsId);



    //henter inn list items 
    loadData();
    async function loadData() {


        let body = {
            listGroupsId: listGroupsId
        }
        let config = {
            method: "POST",
            headers: {
                "content-type": "application/json",
                "authorization": logindataString
            },
            body: JSON.stringify(body)
        }

        try {
            let response = await fetch("/tasks/items", config);
            let data = await response.json();
            if (response.status === 403) {
                location.href = "./userLogin.html";
            }
            listNameHeader.innerText = data.list[0].listName;
            for (let value of data.items) {
                let listDiv = document.createElement("div");
                let html = `
                        <h2>${value.itemName}</h2>                       
                    `;

                listDiv.innerHTML = html;
                container.appendChild(listDiv);

                listDiv.addEventListener('click', function (evt) {
                    localStorage.setItem("itemData", JSON.stringify(value));
                });
            }
        }
        catch (err) {
            console.log("Something went wrong.")
        }

    }

    //oppdatere lister
    document.getElementById("updateList").onclick = async function (evt) {
        if (listName.value.length <= 0) {
            alert("Must type in title");
            return;
        }
        let body = {
            listName: listName.value,
            listGroupsId: listGroupsId
        }
        let config = {
            method: "PUT",
            headers: {
                "content-type": "application/json",
                "authorization": logindataString
            },
            body: JSON.stringify(body)
        }

        try {
            let response = await fetch("/tasks/updateLists", config);
            let data = await response.json();

            console.log(data);
        }
        catch (err) {
            console.log("Something went wrong.")
        }
        window.location.reload();
    }

    //slette lister
    document.getElementById("deleteList").onclick = async function (evt) {

        let body = {
            listGroupsId: listGroupsId
        }
        let config = {
            method: "DELETE",
            headers: {
                "content-type": "application/json",
                "authorization": logindataString
            },
            body: JSON.stringify(body)
        }

        try {
            let response = await fetch("/tasks/deleteLists", config);
            let data = await response.json();

            console.log(data);
        }
        catch (err) {
            console.log("Something went wrong.")
        }
    }

    //Add list item
    document.getElementById("newItem").onclick = async function (evt) {

        let body = {
            itemName: inputItem.value,
            listGroupsId: listGroupsId
        }
        let config = {
            method: "POST",
            headers: {
                "content-type": "application/json",
                "authorization": logindataString
            },
            body: JSON.stringify(body)
        }

        try {
            let response = await fetch("/tasks/addListItem", config);
            let data = await response.json();

            console.log(data);
        }
        catch (err) {
            console.log("Something went wrong.")
        }
        window.location.reload();
    }

</script>




</html>